#!/bin/bash
default_sink=$(pactl get-default-sink)
muted=$(pactl get-sink-mute "$default_sink" | awk '/Mute:/ { print $2; exit }')

function get_volume(){
	pactl get-sink-volume "$default_sink" | grep Volume: | awk 'FNR == 1 { print $5 }' | cut -f1 -d '%'
}

function send_notification() {
	local vol=$(get_volume)
    if [ "$vol" -ge 65 ]; then
		lvl="high"
	elif [ "$vol" -ge 40 ]; then
		lvl="medium"
	elif [ "$vol" -ge 0 ]; then
		lvl="low"	
	fi
	notify-send -a "changevolume" -u low -r "9993" -h int:value:"$vol" -i "audio-volume-$lvl" " ${vol}%" -t 2000
}

case $1 in
	up)
		vol=$(get_volume)
		[ "$muted" = "yes" ] && pactl set-sink-mute "$default_sink" toggle
        
        # Only increase volume if below 145%
        if [ "$vol" -le 145 ]; then
            pactl set-sink-volume "$default_sink" +5%
        fi
		send_notification
		;;
    down)
        [ "$muted" = "yes" ] && pactl set-sink-mute "$default_sink" toggle
        
        pactl set-sink-volume "$default_sink" -5%
        send_notification
        ;;
esac
